---
title: "Exercise_3"
output: html_document
---

3A
```{r}
fruitflies_data = read.table("fruitflies.txt",header=TRUE)
thorax = fruitflies_data$thorax
longevity = fruitflies_data$longevity
loglongevity = log(longevity)
activity = fruitflies_data$activity
```
Loading the data

```{r}
fliesframe = data.frame(thorax=fruitflies_data$thorax,longevity=fruitflies_data$longevity,activity=fruitflies_data$activity,loglongevity=log(fruitflies_data$longevity))

hist(fliesframe$thorax)
qqnorm(fliesframe$thorax)
qqline(fliesframe$thorax)
shapiro.test(fliesframe$thorax)
#Not normal

hist(fliesframe$loglongevity)
qqnorm(fliesframe$loglongevity)
qqline(fliesframe$loglongevity)
shapiro.test(fliesframe$longevity)
#Doubtful normality. Probably not normal but shapiro says could be normal

hist(fliesframe$loglongevity)
qqnorm(fliesframe$loglongevity)
qqline(fliesframe$loglongevity)
shapiro.test(fliesframe$loglongevity)
#Not normal
```
None of the data seem to have a normal distribution. 

```{r}

plot(loglongevity, activity, col = factor(activity))
legend("topleft",
       legend = levels(factor(activity)),
       pch = 19,
       col = factor(levels(factor(activity))))
plot(loglongevity, thorax, col = factor(activity))
legend("topleft",
       legend = levels(factor(activity)),
       pch = 19,
       col = factor(levels(factor(activity))))
# TROUBLES TRYING TO GET THE SLOPE IN THERE AS WELL ! 
#plot(loglongevity, thorax, pch=unclass(activity))
#for (i in 1:3) abline(lm(loglongevity~thorax, data=fruitflies_data[activity==i,])) 
#slide 13 to get the slope
plot(thorax~loglongevity,pch=as.character(activity))


```
As we can see from the first plot, the longevity for the high activity fruitflies tends to be the lowest whereas the activity for the isolated fruitflies tend to have the highest longevity.

In the second plot it seems as if there is a linear relation between loglongevity and thorax in all three groups of activity. Whereas again the isolated group seem to be centered around a higher thorax and loglongevity levels. 


```{r}
qqnorm(residuals(model1)) #whereas model1 = lm(loglongevity~thorax + activity,data=fruitflies_data)
plot(fitted(model1),residuals(model1))
abline(0,0)
plot(loglongevity~thorax,pch=unclass(activity))
#abline(lm(loglongevity~thorax, activity =="high"))
```

# EXTRA! : BUT CAN SOMEONE INTERPRET THE RESIDUAL PLOT?


```{r}
activity = as.factor(fruitflies_data$activity)
model = lm(loglongevity~activity,data=fruitflies_data)

anova(model)  # influence sexual activity on longevity
summary(model) #to find the estimates of the three groups
```
This shows that the p-value is <0.05, which means that it is statistically significant. This means that the activity of a fruitfly is certainly has an stat significant effect on the longevity of a fruitfly. However, this is only when we have not subgrouped yet! So we dont know whether it is applicable to which type of activity of a fruitfly. 
And it is worth mentioning that it only takes one factor into account which is the activity and not the thorax! Therefore the one-way anova is most likely not correct.
# IS THIS DONE CORRECTLY? (YES!)
We can see in the summary that the estimates are the following 
High activity: 3.60212
Isolated activity: 3.60212+0.51722 =4.11934
Low activity: 3.60212+0.39771= 3.999836
According to the estimates longevity decreases with sexual activity. 

```{r}
#method 2 to achieves estimates (this gives the same results)
aggregate(x= loglongevity,
          by = list(activity),
          FUN=mean)

```

This shows that the mean of the (log)longevity is different for every group. Whereas the fruitflies with the isolated activity have the longest (log)longevity compared to the others and the low activity come second and high activity comes last. This is in line with what we found on the graph. 
It could therefore suggest that when there is more activity the (log)longevity decreases with it. 
------------------------------------------------------------

3B
```{r}
model1 = lm(loglongevity~thorax + activity,data=fruitflies_data) # thorax as explanatory variable/ factor
anova(model1) # only the p-value of activity is relevant! 


```
It seems that sexual activity does influences longevity when looking at the p-value  of activity (<0.05). However here we can not say anything about the stat significance of thorax, merely regarding activity. Thus we do the following. 
```{r}
drop1(model1, test="F") # here all the p-values are relevant!
anova(model1, model)
```


This shows us that both thorax and activity have a stat significance in loglongevity. 
To be absolutely sure we compared both models, with and without taking the thorax into consideration. Which shows us that there is indeed a stat significance between them, therefore concluding that there is a difference when taking the thorax into consideration in loglongevity of the fruitflies. 

```{r}
summary(model1)
```
It seems that both isolated- [0.40998] and low activity[0.28570  ] have a better loglongevity compared to the high activity when looking at the estimates. Therefore, one can conclude that the sexual activity decreases the (log)longevity of the fruitflies.
```{r} 
# EXTRA! 
confint(model1)
```
# How can we interpret these results? because there are these are 3 groups of each 25 fruitflies. 
#What are the estimated longevities for the three groups, for flies with the minimal and maximal thorax lengths? [SUNNY PUT YOUR ANSWER HERE!]

3C

```{r}
model2= lm(loglongevity~thorax*activity,data=fruitflies_data); anova(model2)
summary(model2)
anova(model2)
anova(model1,model2)
```
In order to know whether thorax is an interaction term model2 has been created. 
In order to test whether thorax in indeed an interaction term we must compare model2(thorax*activity) with model1(activity+activity) to know for sure whether there is indeed a difference. When we do the anova comparing these two models we do not see a stat significance which implies that the parameter thorax only does not make a stat significant difference on longevity. 

```{r}
fliesframe$thorax = as.numeric(fliesframe$thorax)
flieshigh = fliesframe[which(fliesframe$activity=="high"),]
flieshigh

fliesisolated = fliesframe[which(fliesframe$activity=="isolated"),]
fliesisolated

flieslow = fliesframe[which(fliesframe$activity=="low"),]
flieslow

plot(flieshigh$thorax,flieshigh$loglongevity,main="High activity with loglongevity")
plot(fliesisolated$thorax,fliesisolated$loglongevity,main="Isolated activity with loglongevity")
plot(flieslow$thorax,flieslow$loglongevity,main="Low activity with loglongevity")

fliesframe$thorax = as.factor(fliesframe$thorax)
boxplot(loglongevity~thorax+activity,data=fliesframe)

interaction.plot(fliesframe$thorax,fliesframe$activity,fliesframe$loglongevity)

plot(fliesframe$loglongevity~fliesframe$thorax,pch=as.character(fliesframe$activity))

plot(thorax, loglongevity, col = factor(activity))
legend("topleft",
       legend = levels(factor(activity)),
       pch = 19,
       col = factor(levels(factor(activity))))
```

I think merely the last plot is most relevant in for this question. It does not seem as if the longevity is influences by thorax length in either groups. 

3D 

The analysis with the thorax length should not be included because there should not be interaction between the sexual activity and the thorax length. This is because the experimenters randomly chose the sexual activity that the flies were going to have.

3E
```{r}
#model1 = lm(loglongevity~thorax + activity,data=fruitflies_data) # thorax as explanatory variable/ factor
#model2= lm(loglongevity~thorax*activity,data=fruitflies_data);
model3= lm(longevity~thorax*activity,data=fruitflies_data)
anova(model3)
model4 =  lm(longevity~thorax+activity,data=fruitflies_data) 
anova(model4)
anova(model3)
anova(model1,model4)
anova(model2,model3)

```
The models do not differ in terms of siginifance however it is noteworty mentioning that logarithmic transformation is a convenient means of transforming a highly skewed variable into a more normalized dataset. When modeling variables with non-linear relationships, the chances of producing errors may also be skewed negatively.